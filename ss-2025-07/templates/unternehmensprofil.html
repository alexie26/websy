{% extends 'layout.html' %}

{% block content %}
<div class="container mt-4">
    <h2>Willkommen, {{ anbieter_name }}</h2>

<div class="page-header">
    <div class="container">
        <h1 class="mb-0"><i class="fas fa-building"></i> Willkommen, {{ anbieter_name }}</h1>
        <p class="lead mb-0">Verwalten Sie Ihr Unternehmensprofil und Ihre Dienstleistungen</p>
    </div>
</div>
{#    unternehmensprofil#}
<div class="container">
    <section class="profile-section">
        <h3><i class="fas fa-user-tie"></i> Unternehmensprofil</h3>
        <form method="post" enctype="multipart/form-data" action="/anbieter/profil_speichern">
            <div class="row">
                <div class="col-md-6">
                    <label for="profilbild" class="form-label">
                        <i class="fas fa-image"></i> Profilbild:
                    </label>
                    <input type="file" name="profilbild" id="profilbild" class="form-control mb-3" accept="image/*">
                    <div class="form-text">Unterstützte Formate: JPG, PNG, GIF (max. 16MB)</div>
                </div>
                <div class="col-md-6">
                    <label for="beschreibung" class="form-label">
                        <i class="fas fa-align-left"></i> Unternehmensbeschreibung:
                    </label>
                    <textarea name="beschreibung" id="beschreibung" placeholder="Beschreiben Sie Ihr Unternehmen..."
                              class="form-control" rows="4" required>{{ beschreibung }}</textarea>
                </div>
            </div>
            <button class="btn btn-primary mt-3">
                <i class="fas fa-save"></i> Profil speichern
            </button>
        </form>
    </section>

    <!-- Dienstleistungen verwalten -->
    <section class="profile-section">
        <h3><i class="fas fa-concierge-bell"></i> Dienstleistungen hinzufügen</h3>
        <form method="post" action="/anbieter/dienstleistung/hinzufuegen" id="dienstleistungenForm">
            <div id="dienstleistungenContainer">
                <div class="dienstleistung">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0"><i class="fas fa-wrench"></i> Neue Dienstleistung</h6>
                        <button type="button" class="btn btn-sm btn-danger" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i> Entfernen
                        </button>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" name="titel[]" placeholder="Titel (z.B. Haarschnitt)" class="form-control mb-2" required>
                        </div>
                        <div class="col-md-6">
                            <input type="number" name="dauer[]" placeholder="Dauer (in Minuten)" class="form-control mb-2" required min="1" max="480">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <input type="text" name="kurzbeschreibung[]" placeholder="Kurzbeschreibung" class="form-control mb-2" required>
                        </div>
                        <div class="col-md-4">
                            <input type="number" step="0.01" name="preis[]" placeholder="Preis (€)" class="form-control mb-2" required min="0">
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex gap-2">
                <button type="button" class="btn btn-secondary" onclick="addDienstleistung()">
                    <i class="fas fa-plus"></i> Weitere Dienstleistung hinzufügen
                </button>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus-circle"></i> Alle Dienstleistungen speichern
                </button>
            </div>
        </form>
    </section>

    <!-- Existierende Dienstleistungen -->
    {% if dienstleistungen %}
    <section class="profile-section">
        <h3><i class="fas fa-list"></i> Ihre aktuellen Dienstleistungen</h3>
        <div class="row">
            {% for dienst in dienstleistungen %}
            <div class="col-md-6 col-lg-4 mb-3">
                <div class="card service-card h-100">
                    <div class="card-body">
                        <h5 class="card-title text-primary">
                            <i class="fas fa-cog"></i> {{ dienst.titel }}
                        </h5>
                        <p class="card-text">{{ dienst.kurzbeschreibung }}</p>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge bg-info">
                                <i class="fas fa-clock"></i> {{ dienst.dauer }}
                            </span>
                            <strong class="text-success">
                                <i class="fas fa-euro-sign"></i> {{ "%.2f"|format(dienst.preis) }}
                            </strong>
                        </div>
                        <div class="d-flex gap-1">
                            <a href="/anbieter/dienstleistung/bearbeiten/{{ dienst.id }}" class="btn btn-sm btn-warning flex-fill">
                                <i class="fas fa-edit"></i> Bearbeiten
                            </a>
                            <a href="/anbieter/dienstleistung/loeschen/{{ dienst.id }}" class="btn btn-sm btn-danger flex-fill"
                               onclick="return confirm('Sind Sie sicher, dass Sie diese Dienstleistung löschen möchten?')">
                                <i class="fas fa-trash"></i> Löschen
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% else %}
    <section class="profile-section">
        <div class="alert alert-info text-center">
            <i class="fas fa-info-circle"></i>
            <strong>Keine Dienstleistungen vorhanden</strong><br>
            Fügen Sie Ihre ersten Dienstleistungen hinzu, um Kunden anzuziehen!
        </div>
    </section>
    {% endif %}

    <!-- Bildergalerie -->
    <section class="profile-section">
        <h3><i class="fas fa-images"></i> Bilder von durchgeführten Dienstleistungen</h3>
        <form method="post" enctype="multipart/form-data" action="/anbieter/bilder/hochladen">
            <div class="row">
                <div class="col-md-8">
                    <input type="file" name="dienstleistungsbild" class="form-control" multiple accept="image/*">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-secondary w-100">
                        <i class="fas fa-upload"></i> Bilder hochladen
                    </button>
                </div>
            </div>
        </form>

        {% if bilder %}
        <div class="row mt-3">
            {% for bild in bilder %}
            <div class="col-md-3 col-sm-6 mb-3">
                <img src="{{ bild.url }}" class="img-fluid rounded shadow-sm" alt="Dienstleistungsbild" style="height: 200px; object-fit: cover; width: 100%;">
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </section>

    <!-- Buchungskalender -->
    <section class="profile-section">
        <h3><i class="fas fa-calendar-alt"></i> Buchungskalender</h3>
        <p class="text-muted">Verwalten Sie Ihre Termine und Buchungen</p>
        <a href="/anbieter/kalender" class="btn btn-outline-primary">
            <i class="fas fa-calendar-check"></i> Kalender anzeigen
        </a>
    </section>

    <!-- Bewertungen -->
    {% if bewertungen %}
    <section class="profile-section">
        <h3><i class="fas fa-star"></i> Bewertungen</h3>
        <div class="row">
            {% for bewertung in bewertungen %}
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="card-title mb-0">{{ bewertung.kunde_name }}</h6>
                            <div class="text-warning">
                                {% for i in range(bewertung.sterne) %}
                                <i class="fas fa-star"></i>
                                {% endfor %}
                                {% for i in range(5 - bewertung.sterne) %}
                                <i class="far fa-star"></i>
                                {% endfor %}
                            </div>
                        </div>
                        <p class="card-text">{{ bewertung.text }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Hilfe anfordern -->
    <section class="profile-section">
        <h3><i class="fas fa-question-circle"></i> Hilfe & Support</h3>
        <form method="post" action="/anbieter/hilfe">
            <div class="row">
                <div class="col-md-8">
                    <textarea name="nachricht" placeholder="Beschreiben Sie Ihr Problem oder Ihre Frage..."
                              class="form-control" rows="3" required></textarea>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button class="btn btn-danger w-100">
                        <i class="fas fa-headset"></i> Hilfe anfordern
                    </button>
                </div>
            </div>
        </form>
    </section>
</div>

<!-- Dienstleistungs-Script -->
<script>
    function addDienstleistung() {
        const container = document.getElementById('dienstleistungenContainer');
        const dienstleistungCount = container.children.length + 1;

        const neueDienstleistung = document.createElement('div');
        neueDienstleistung.classList.add('dienstleistung');

        neueDienstleistung.innerHTML = `
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0"><i class="fas fa-wrench"></i> Dienstleistung ${dienstleistungCount}</h6>
                <button type="button" class="btn btn-sm btn-danger" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i> Entfernen
                </button>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <input type="text" name="titel[]" placeholder="Titel (z.B. Haarschnitt)" class="form-control mb-2" required>
                </div>
                <div class="col-md-6">
                    <input type="number" name="dauer[]" placeholder="Dauer (in Minuten)" class="form-control mb-2" required min="1" max="480">
                </div>
            </div>
            <div class="row">
                <div class="col-md-8">
                    <input type="text" name="kurzbeschreibung[]" placeholder="Kurzbeschreibung" class="form-control mb-2" required>
                </div>
                <div class="col-md-4">
                    <input type="number" step="0.01" name="preis[]" placeholder="Preis (€)" class="form-control mb-2" required min="0">
                </div>
            </div>
        `;

        container.appendChild(neueDienstleistung);
    }

    // Form validation
    document.getElementById('dienstleistungenForm').addEventListener('submit', function(e) {
        const dienstleistungen = document.querySelectorAll('.dienstleistung');
        if (dienstleistungen.length === 0) {
            e.preventDefault();
            alert('Bitte fügen Sie mindestens eine Dienstleistung hinzu.');
            return false;
        }

        // Check if all required fields are filled
        let allValid = true;
        dienstleistungen.forEach(function(dienst) {
            const inputs = dienst.querySelectorAll('input[required]');
            inputs.forEach(function(input) {
                if (!input.value.trim()) {
                    allValid = false;
                    input.classList.add('is-invalid');
                } else {
                    input.classList.remove('is-invalid');
                }
            });
        });

        if (!allValid) {
            e.preventDefault();
            alert('Bitte füllen Sie alle Pflichtfelder aus.');
            return false;
        }
    });
</script>
{% endblock %}
